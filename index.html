<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatizaci贸n Actas de Reuni贸n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --bg-pattern: radial-gradient(circle at 50% 0%, #eef2ff 0%, transparent 35%);
            --text-primary: #1e293b;
            --text-secondary: #6b7280; /* gray-500 */
            --card-bg: #ffffff;
            --card-border: #e2e8f0;
            --generator-inner-bg: #f8fafc; /* Lighter than slate-100 */
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --input-text: #1e293b;
            --input-placeholder: #9ca3af; /* gray-400 */
            --btn-primary-bg: #9333ea; /* purple-600 */
            --btn-primary-hover: #7e22ce; /* purple-700 */
            --contact-card-bg: #ffffff; /* White background for the card */
            --contact-border: #e2e8f0;
            --contact-inner-border: #a78bfa; /* Light purple */
            --purple-text: #9333EA; 
            --particle-color: rgba(96, 165, 250, 0.5); /* Light Blue, more visible */
            --interactive-hover-color: #3b82f6;
            --email-link-color: #6d28d9;
        }

        body.dark {
            --bg-color: #111827;
            --bg-pattern: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.15) 0%, transparent 35%);
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db; /* gray-300 */
            --card-bg: #1f2937;
            --card-border: #374151;
            --generator-inner-bg: #111827;
            --input-bg: #374151;
            --input-border: #4b5563;
            --input-text: #f9fafb;
            --input-placeholder: #6b7280; /* gray-500 */
            --btn-primary-bg: #a855f7; /* purple-500 */
            --btn-primary-hover: #9333ea; /* purple-600 */
            --contact-card-bg: #1f2937;
            --contact-border: #374151;
            --contact-inner-border: #8b5cf6;
            --purple-text: #c084fc; 
            --particle-color: rgba(192, 132, 252, 0.4); /* Purple, more visible */
            --interactive-hover-color: #60a5fa;
            --email-link-color: #a78bfa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            background-image: var(--bg-pattern);
            background-repeat: no-repeat;
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }
        
        #background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--btn-primary-bg);
            color: #ffffff;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: var(--btn-primary-hover);
            transform: scale(1.03);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(1);
        }

        #meeting-summary {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--input-text);
            min-height: 200px;
        }
        #meeting-summary::placeholder {
            color: var(--input-placeholder);
            line-height: 1.6;
        }

        /* Interactive Title Style */
        .interactive-letter {
            display: inline-block;
            transition: color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }
        .interactive-letter:hover {
            color: var(--interactive-hover-color);
            transform: translateY(-5px) scale(1.05);
        }

        .loader {
            width: 50px; height: 50px; border-radius: 50%; position: relative; animation: rotate 1s linear infinite;
        }
        .loader::before, .loader::after {
            content: ""; box-sizing: border-box; position: absolute; inset: 0px; border-radius: 50%; border: 5px solid var(--card-border); animation: prixClipFix 2s linear infinite ;
        }
        .loader::after{
            border-color: var(--purple-text); animation: prixClipFix 2s linear infinite , rotate 0.5s linear infinite reverse; inset: 6px;
        }
        
        #theme-toggle {
            position: fixed; bottom: 1rem; right: 1rem;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        #theme-toggle svg {
            color: var(--text-primary); transition: color 0.3s;
        }
        .dark #dark-mode-content { display: flex; }
        .dark #light-mode-content { display: none; }
        #dark-mode-content { display: none; }
        #light-mode-content { display: flex; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spin-animation {
            animation: spin 0.5s ease-in-out;
        }

        /* Acta Styles */
        #acta-generada {
            border: 1px solid var(--card-border);
            padding: 1rem;
            border-radius: 0.75rem;
            background-color: var(--input-bg);
            font-family: Arial, sans-serif;
            font-size: 10pt;
            transition: all 0.3s ease;
        }
        #acta-generada[contenteditable="true"] {
            outline: 2px dashed var(--purple-text);
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.2);
        }
        .acta-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
        }
        .acta-table td, .acta-table th {
            border: 1px solid #000;
            padding: 4px 8px;
            vertical-align: middle;
            text-align: center;
        }
        .acta-table th {
            font-weight: bold;
        }
        .acta-blue-header {
            background-color: #1F3864;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        .acta-nota {
            font-size: 8pt;
            text-align: justify;
            margin: 1rem 0;
        }
        .firma-cell {
            height: 4rem;
        }
        .acta-header-info {
            font-size: 0.9em;
        }
        .acta-header-title {
            font-weight: bold;
            text-align: center;
        }

        @keyframes rotate { 0% {transform: rotate(0deg)} 100% {transform: rotate(360deg)} }
        @keyframes prixClipFix { 0% {clip-path:polygon(50% 50%,0 0,0 0,0 0,0 0,0 0)} 25% {clip-path:polygon(50% 50%,0 0,100% 0,100% 0,100% 0,100% 0)} 50% {clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,100% 100%,100% 100%)} 75% {clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 100%)} 100% {clip-path:polygon(50% 50%,0 0,100% 0,100% 100%,0 100%,0 0)} }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }
    </style>
</head>
<body>
    <canvas id="background-particles"></canvas>

    <header class="py-12 px-4 text-center relative z-10">
        <h1 id="main-title" class="text-3xl sm:text-4xl md:text-5xl font-extrabold tracking-tight mb-6 uppercase" style="color: var(--text-primary);">
            AUTOMATIZACIN ACTAS DE REUNIN
        </h1>
        <p class="max-w-4xl mx-auto text-base sm:text-lg" style="color: var(--text-secondary);">
            Herramienta innovadora que transforma tus reuniones en actas claras, precisas y listas al instante, optimizando el tiempo y garantizando la calidad en la documentaci贸n.
        </p>
    </header>

    <main class="px-4 md:px-8 py-8 relative z-10">
        
        <section id="generator" class="mb-24 max-w-5xl mx-auto card rounded-2xl">
            <div class="p-4 sm:p-6 md:p-8">
                <div class="flex items-center justify-center gap-2 sm:gap-4 mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sm:w-8 sm:h-8" style="color: var(--text-primary);"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold tracking-tight">
                        GENERADOR DE <span style="color: var(--purple-text);">ACTAS DE REUNIN</span>
                    </h2>
                </div>

                <div class="rounded-xl p-4 sm:p-6 md:p-8 text-left" style="background-color: var(--generator-inner-bg);">
                    <label for="meeting-summary" class="block font-semibold mb-3" style="color: var(--text-primary);">Pega aqu铆 la transcripci贸n de la reuni贸n:</label>
                    <div class="w-full">
                        <textarea id="meeting-summary" rows="10" class="w-full p-4 rounded-xl border focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition" placeholder="Nota: Ten lista la transcripci贸n completa y organizada, incluyendo:&#10;- Fecha&#10;- Hora de inicio&#10;- Hora de fin&#10;- Ciudad&#10;- Sede&#10;- Participantes y cargos"></textarea>
                    </div>
                    
                    <div class="text-center">
                        <button id="generate-btn" class="btn-primary mt-6 py-3 px-8 text-base sm:text-lg font-semibold rounded-lg shadow-lg w-full sm:w-auto">
                            Generar Acta Inteligente
                        </button>
                    </div>

                    <div id="loader-container" class="hidden justify-center mt-8">
                        <div class="loader"></div>
                    </div>
                    <div id="error-message" class="hidden mt-6 text-red-600 bg-red-100 border border-red-300 p-4 rounded-lg"></div>

                    <div id="result-container" class="hidden mt-10 text-left">
                        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 flex-wrap gap-4">
                            <h3 class="text-xl sm:text-2xl font-bold">Acta de Reuni贸n Generada</h3>
                            <div class="flex items-center gap-2">
                                <button id="edit-btn" class="py-2 px-4 rounded-lg flex items-center gap-2 transition" style="background-color: var(--card-border); color: var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                                    <span id="edit-text">Editar</span>
                                </button>
                                <button id="copy-btn" class="py-2 px-4 rounded-lg flex items-center gap-2 transition" style="background-color: var(--card-border); color: var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                                    <span id="copy-text">Copiar</span>
                                </button>
                                <button id="export-word-btn" class="btn-primary py-2 px-4 rounded-lg flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-8l-2 2"/><path d="m14 10-4 8"/></svg>
                                    <span>Exportar a Word</span>
                                </button>
                            </div>
                        </div>
                        <div id="acta-generada" class="overflow-x-auto"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="my-24 max-w-5xl mx-auto text-center card rounded-2xl p-6 sm:p-8 md:p-10">
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                <span class="text-3xl"></span>
                <h2 class="text-xl sm:text-2xl font-bold">驴Quieres llevar la automatizaci贸n m谩s all谩?</h2>
            </div>
            <p class="text-base sm:text-lg max-w-3xl mx-auto" style="color: var(--text-secondary);">
                Si tienes propuestas para optimizar tus actividades con IA o quieres conocer herramientas que te ayuden a mejorar los procesos, estamos listos para apoyarte.
            </p>
            <div class="mt-8 p-6 rounded-xl inline-block text-center" style="border: 1px solid var(--contact-inner-border);">
                <h3 class="font-bold text-lg mb-4 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    Comun铆cate con el rea de Procesos:
                </h3>
                <ul class="list-none space-y-2">
                    <li class="break-all"><a href="mailto:coord-procesos@clinicalaermitadecartagena.com" class="hover:underline" style="color: var(--email-link-color);">coord-procesos@clinicalaermitadecartagena.com</a></li>
                    <li class="break-all"><a href="mailto:aprendiz-procesos2@clinicalaermitadecartagena.com" class="hover:underline" style="color: var(--email-link-color);">aprendiz-procesos2@clinicalaermitadecartagena.com</a></li>
                </ul>
            </div>
        </section>

    </main>
    
    <button id="theme-toggle" title="Cambiar tema">
        <div id="light-mode-content" class="items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            <span class="hidden sm:inline">Tema Claro</span>
        </div>
        <div id="dark-mode-content" class="items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <span class="hidden sm:inline">Tema Oscuro</span>
        </div>
    </button>

    <footer class="text-center p-8 border-t relative z-10" style="border-color: var(--card-border);">
        <p class="text-sm" style="color: var(--text-secondary);">Dise帽o interactivo creado por IA para demostrar capacidades de automatizaci贸n.</p>
        
        <div class="relative group flex justify-center mt-4">
            <div class="flex items-center gap-2 text-xs cursor-pointer opacity-75 hover:opacity-100 transition-opacity" style="color: var(--text-secondary);">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 animate-spin-slow"><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m17.66 17.66 1.41 1.41"/><path d="M12 22v-2"/><path d="m6.34 17.66-1.41 1.41"/><path d="M4 12H2"/><path d="m6.34 6.34-1.41-1.41"/><circle cx="12" cy="12" r="3"/><path d="M12 8a2.83 2.83 0 0 0 4 4L12 8Z"/></svg>
                <span>rea de Procesos</span>
            </div>
            <div class="absolute bottom-full mb-3 w-max max-w-xs p-3 text-sm rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" style="background-color: var(--card-bg); color: var(--text-primary); border: 1px solid var(--card-border);">
                Cada mejora cuenta: Convertimos ideas en eficiencia y datos en decisiones inteligentes.
                <div class="absolute left-1/2 -translate-x-1/2 top-full w-0 h-0 border-x-8 border-x-transparent border-t-8" style="border-top-color: var(--card-border);"></div>
                <div class="absolute left-1/2 -translate-x-1/2 top-full mt-[-1px] w-0 h-0 border-x-8 border-x-transparent border-t-8" style="border-top-color: var(--card-bg);"></div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let actaData = null;
            let isEditing = false;

            // --- INTERACTIVE TITLE ---
            const title = document.getElementById('main-title');
            if (title) {
                const text = title.innerText;
                title.innerHTML = '';
                for (const char of text) {
                    const letterSpan = document.createElement('span');
                    letterSpan.textContent = char;
                    if (char.trim() !== '') {
                        letterSpan.classList.add('interactive-letter');
                    }
                    title.appendChild(letterSpan);
                }
            }

            // --- THEME TOGGLE ---
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            const lightIcon = document.querySelector('#light-mode-content svg');
            const darkIcon = document.querySelector('#dark-mode-content svg');

            const applyTheme = (theme, isInitialLoad = false) => {
                const isDark = theme === 'dark';
                body.classList.toggle('dark', isDark);

                if (!isInitialLoad) {
                    if (isDark) {
                        darkIcon.classList.add('spin-animation');
                        setTimeout(() => darkIcon.classList.remove('spin-animation'), 500);
                    } else {
                        lightIcon.classList.add('spin-animation');
                        setTimeout(() => lightIcon.classList.remove('spin-animation'), 500);
                    }
                }
            };
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme, true);
            themeToggle.addEventListener('click', () => {
                const newTheme = body.classList.contains('dark') ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });

            // --- PARTICLE BACKGROUND ---
            const canvas = document.getElementById('background-particles');
            const ctx = canvas.getContext('2d');
            let particlesArray;
            let mouse = { x: null, y: null, radius: 150 };

            window.addEventListener('mousemove', (event) => { mouse.x = event.x; mouse.y = event.y; });
            window.addEventListener('mouseout', () => { mouse.x = undefined; mouse.y = undefined; });

            function setupCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            class Particle {
                constructor(x, y, dX, dY, s) { this.x = x; this.y = y; this.dX = dX; this.dY = dY; this.size = s; this.baseSize = s; }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--particle-color').trim();
                    ctx.fill();
                }
                update() {
                    if (this.x > canvas.width || this.x < 0) { this.dX = -this.dX; }
                    if (this.y > canvas.height || this.y < 0) { this.dY = -this.dY; }
                    this.x += this.dX; this.y += this.dY;
                    if (mouse.x && mouse.y) {
                        let dx = mouse.x - this.x; let dy = mouse.y - this.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < mouse.radius && this.size < this.baseSize + 3) { this.size += 0.5; }
                        else if (this.size > this.baseSize) { this.size -= 0.1; }
                    } else if (this.size > this.baseSize) { this.size -= 0.1; }
                    if (this.size < this.baseSize) { this.size = this.baseSize; }
                    this.draw();
                }
            }
            function initParticles() {
                particlesArray = [];
                let num = (canvas.height * canvas.width) / 15000;
                for (let i = 0; i < num; i++) {
                    let s = (Math.random() * 2) + 1.5;
                    let x = Math.random() * (innerWidth - s * 2) + s * 2;
                    let y = Math.random() * (innerHeight - s * 2) + s * 2;
                    let dX = (Math.random() * 1) - 0.5;
                    let dY = (Math.random() * 1) - 0.5;
                    particlesArray.push(new Particle(x, y, dX, dY, s));
                }
            }
            function animateParticles() { requestAnimationFrame(animateParticles); ctx.clearRect(0,0,innerWidth, innerHeight); particlesArray.forEach(p => p.update()); }
            setupCanvas(); initParticles(); animateParticles();
            window.addEventListener('resize', () => { setupCanvas(); initParticles(); });

            // --- GENERATOR LOGIC ---
            const generateBtn = document.getElementById('generate-btn');
            const summaryInput = document.getElementById('meeting-summary');
            const resultContainer = document.getElementById('result-container');
            const actaContainer = document.getElementById('acta-generada');
            const loaderContainer = document.getElementById('loader-container');
            const errorMessage = document.getElementById('error-message');
            const editBtn = document.getElementById('edit-btn');
            const editText = document.getElementById('edit-text');
            const copyBtn = document.getElementById('copy-btn');
            const copyText = document.getElementById('copy-text');
            const exportWordBtn = document.getElementById('export-word-btn');
            
            generateBtn.addEventListener('click', handleGeneration);
            editBtn.addEventListener('click', toggleEditMode);
            copyBtn.addEventListener('click', () => copyToClipboard(actaContainer.innerText, copyText, '隆Copiado!'));
            exportWordBtn.addEventListener('click', exportToWord);

            function toggleEditMode() {
                isEditing = !isEditing;
                actaContainer.contentEditable = isEditing;
                
                if (isEditing) {
                    editText.textContent = 'Guardar';
                    editBtn.classList.add('btn-primary');
                    actaContainer.focus();
                    copyBtn.disabled = true;
                    exportWordBtn.disabled = true;
                    copyBtn.style.opacity = '0.5';
                    exportWordBtn.style.opacity = '0.5';
                } else {
                    editText.textContent = 'Editar';
                    editBtn.classList.remove('btn-primary');
                    copyBtn.disabled = false;
                    exportWordBtn.disabled = false;
                    copyBtn.style.opacity = '1';
                    exportWordBtn.style.opacity = '1';
                }
            }

            function resetEditState() {
                isEditing = false;
                actaContainer.contentEditable = false;
                editText.textContent = 'Editar';
                editBtn.classList.remove('btn-primary');
                copyBtn.disabled = false;
                exportWordBtn.disabled = false;
                copyBtn.style.opacity = '1';
                exportWordBtn.style.opacity = '1';
            }

            async function handleGeneration() {
                const summary = summaryInput.value.trim();
                if (!summary) {
                    showError("Por favor, pega la transcripci贸n de la reuni贸n para generar el acta.");
                    return;
                }
                hideError();
                resultContainer.classList.add('hidden');
                loaderContainer.classList.remove('hidden');
                loaderContainer.classList.add('flex');
                generateBtn.disabled = true;
                generateBtn.innerHTML = 'Generando...';
                try {
                    const actaContent = await generateActaWithAI(summary);
                    actaData = actaContent;
                    displayActa(actaContent);
                    resetEditState();
                    resultContainer.classList.remove('hidden');
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } catch (error) {
                    console.error("Error generating minutes:", error);
                    showError("Hubo un error al contactar a la IA. Revisa el formato o int茅ntalo de nuevo.");
                } finally {
                    loaderContainer.classList.add('hidden');
                    loaderContainer.classList.remove('flex');
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = 'Generar Acta Inteligente';
                }
            }

            async function generateActaWithAI(text) {
                const currentDate = new Date();
                const prompt = `Eres un asistente de IA experto en crear actas de reuni贸n para la "Cl铆nica La Ermita" (formato R-GC-010). Analiza el texto y transf贸rmalo en un acta profesional, extrayendo la informaci贸n de forma precisa.
                **INSTRUCCIONES OBLIGATORIAS:**
                1.  **EXTRAE Y ESTRUCTURA:** Analiza el texto para completar estos campos. Si un campo no se puede determinar, d茅jalo como un string vac铆o "".
                    * **encabezado**: { fecha, horaInicio, horaFin, ciudad, sede }
                    * **objetivo**: Redacta un objetivo claro y preciso para la reuni贸n, bas谩ndote en el contenido general de la transcripci贸n. Debe ser una frase concisa que resuma el prop贸sito principal.
                    * **ordenDelDia**: Array de { tema, desarrollo }. Para el desarrollo, crea un resumen detallado, claro y preciso de lo discutido sobre ese tema. Aseg煤rate de incluir todos los puntos relevantes, datos, cifras y decisiones tomadas. La informaci贸n debe ser completa y pertinente.
                    * **compromisos**: Array de { compromiso, responsable, fechaEjecucion }. Calcula fechas relativas (ej. "pr贸ximo martes") basado en la fecha actual.
                    * **participantes**: Array de { nombre, cargo }.
                    * **proximaReunion**: { tema, fecha }.
                2.  **FORMATO DE SALIDA:** El resultado DEBE ser un 煤nico objeto JSON v谩lido. No incluyas texto, explicaciones, ni markdown antes o despu茅s del JSON.
                **Fecha Actual para referencia:** ${currentDate.toISOString()}
                **Texto a Procesar:**\n---\n${text}\n---`;
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "encabezado": { type: "OBJECT", properties: { "fecha": { type: "STRING" }, "horaInicio": { type: "STRING" }, "horaFin": { type: "STRING" }, "ciudad": { type: "STRING" }, "sede": { type: "STRING" } } },
                                "objetivo": { type: "STRING" },
                                "ordenDelDia": { type: "ARRAY", items: { type: "OBJECT", properties: { "tema": { type: "STRING" }, "desarrollo": { type: "STRING" } }, required: ["tema", "desarrollo"] } },
                                "compromisos": { type: "ARRAY", items: { type: "OBJECT", properties: { "compromiso": { type: "STRING" }, "responsable": { type: "STRING" }, "fechaEjecucion": { type: "STRING" } }, required: ["compromiso", "responsable", "fechaEjecucion"] } },
                                "participantes": { type: "ARRAY", items: { type: "OBJECT", properties: { "nombre": { type: "STRING" }, "cargo": { type: "STRING" } }, required: ["nombre", "cargo"] } },
                                "proximaReunion": { type: "OBJECT", properties: { "tema": { type: "STRING" }, "fecha": { type: "STRING" } } }
                            }
                        }
                    }
                };
                const apiKey = "AIzaSyCMwOJDw0GAqifxAiqsA4M-UgBZvV5H0YM"; // Provided by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorBody = await response.text(); throw new Error(`API request failed: ${errorBody}`); }
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) { return JSON.parse(result.candidates[0].content.parts[0].text); }
                throw new Error("La respuesta de la IA no tuvo el formato esperado.");
            }

            function displayActa(data) {
                const e = data.encabezado || {}; const pr = data.proximaReunion || {};
                const ordenDelDiaRows = Math.max(10, data.ordenDelDia?.length || 0);
                const compromisosRows = Math.max(10, data.compromisos?.length || 0);
                const participantesRows = Math.max(5, data.participantes?.length || 0);
                actaContainer.innerHTML = `
                    <div style="border: 1px solid #000; padding: 1rem; background-color: white; color: black;">
                        <table class="acta-table" style="margin-bottom: 1rem;">
                            <tr>
                                <td rowspan="2" style="width: 20%; text-align: center; vertical-align: middle; font-weight: bold; font-size: 1.1em;">CLNICA LA ERMITA DE CARTAGENA</td>
                                <td class="acta-header-title" style="width: 60%; font-size: 1.2em; border-bottom: 1px solid #000;">ACTA REUNIN</td>
                                <td class="acta-header-info" style="width: 20%;" rowspan="2"><strong>CDIGO:</strong> R-GC-010<br><strong>Version:</strong> 02<br><strong>Vigente desde:</strong> 2024.08.22</td>
                            </tr><tr><td class="acta-header-title">GESTION DE CALIDAD</td></tr>
                        </table>
                        <p class="acta-nota"><strong>NOTA:</strong> Antes de dar lectura al orden del d铆a de la presente reuni贸n, se advirti贸 a los en ella participantes que, si dentro los asuntos tratados en la presente sesi贸n se relaciona informaci贸n referida a datos personales, la misma no podr谩 ser divulgada y solo puede ser accedida por quienes en desarrollo de sus competencias laborales se encuentren facultados para ello, debi茅ndose asegurar su confidencialidad. De ser necesaria la reproducci贸n del acta que recoge esta sesi贸n, se utilizar谩 la anonimizaci贸n del titular que en particular hubiere sido mencionado (no referir el titular), salvo que se trate de orden judicial o administrativa.</p>
                        <table class="acta-table" style="margin-bottom: 1rem;">
                           <tbody>
                                <tr>
                                    <td class="acta-blue-header" rowspan="2" style="width: 25%;"><strong>FECHA INICIO REUNIN:</strong></td><td rowspan="2" style="width: 25%;">${e.fecha || ''}</td>
                                    <td class="acta-blue-header" style="width: 15%;"><strong>HORA INICIO:</strong></td><td style="width: 15%;">${e.horaInicio || ''}</td>
                                    <td class="acta-blue-header" style="width: 10%;"><strong>CIUDAD:</strong></td><td style="width: 10%;">${e.ciudad || ''}</td>
                                </tr>
                                <tr>
                                    <td class="acta-blue-header"><strong>HORA DE FIN:</strong></td><td>${e.horaFin || ''}</td>
                                    <td class="acta-blue-header"><strong>SEDE:</strong></td><td>${e.sede || ''}</td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="acta-table"><thead><tr class="acta-blue-header"><th colspan="1">OBJETIVO DE LA REUNIN</th></tr></thead><tbody><tr><td style="min-height: 50px; text-align: left; vertical-align: top;">${data.objetivo || ''}</td></tr></tbody></table>
                        <table class="acta-table" style="margin-top: 1rem;"><thead class="acta-blue-header"><tr><th style="width: 5%;">No.</th><th style="width: 45%;">TEMA A TRATAR / ORDEN DEL DIA</th><th style="width: 50%;">DESARROLLO DEL TEMA</th></tr></thead>
                            <tbody>${[...Array(ordenDelDiaRows)].map((_, i) => `<tr><td style="text-align: center;">${i + 1}</td><td style="text-align: left; vertical-align: top;">${data.ordenDelDia?.[i]?.tema || ''}</td><td style="text-align: left; vertical-align: top;">${data.ordenDelDia?.[i]?.desarrollo || ''}</td></tr>`).join('')}</tbody>
                        </table>
                        <div style="page-break-before: always;"></div>
                        <table class="acta-table" style="margin-top: 2rem;"><thead class="acta-blue-header"><tr><th style="width: 5%;">No.</th><th>COMPROMISOS</th><th>RESPONSABLE</th><th>FECHA DE EJECUCIN</th></tr></thead>
                            <tbody>${[...Array(compromisosRows)].map((_, i) => `<tr><td style="text-align: center;">${i + 1}</td><td style="text-align: left; vertical-align: top;">${data.compromisos?.[i]?.compromiso || ''}</td><td style="text-align: left; vertical-align: top;">${data.compromisos?.[i]?.responsable || ''}</td><td>${data.compromisos?.[i]?.fechaEjecucion || ''}</td></tr>`).join('')}</tbody>
                        </table>
                        <table class="acta-table" style="margin-top: 1rem;"><thead class="acta-blue-header"><tr><th>TEMA PROXIMA REUNIN</th><th>FECHA PRXIMA REUNIN</th></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top;">${pr.tema || ''}</td><td>${pr.fecha || ''}</td></tr></tbody></table>
                        <table class="acta-table" style="margin-top: 1rem;">
                            <thead><tr class="acta-blue-header"><th colspan="3">PARTICIPANTES</th></tr><tr class="acta-blue-header"><th>NOMBRES Y APELLIDOS</th><th>CARGO</th><th>FIRMA</th></tr></thead>
                            <tbody>${[...Array(participantesRows)].map((_, i) => `<tr><td style="text-align: left; vertical-align: top;">${data.participantes?.[i]?.nombre || ''}</td><td style="text-align: left; vertical-align: top;">${data.participantes?.[i]?.cargo || ''}</td><td class="firma-cell"></td></tr>`).join('')}</tbody>
                        </table>
                    </div>`;
            }

            function createWordHtml() {
                const content = document.getElementById('acta-generada').firstElementChild;
                if (!content) return "";
                let html = `
                    <html xmlns:w='urn:schemas-microsoft-com:office:word'>
                        <head>
                            <meta charset='utf-8'>
                            <title>Acta de Reuni贸n</title>
                            <style>
                                body { font-family: Arial, sans-serif; font-size: 10pt; }
                                table { border-collapse: collapse; width: 100%; margin-bottom: 1rem; }
                                td, th { border: 1px solid black; padding: 4px 8px; vertical-align: middle; text-align: center;}
                                .acta-blue-header { background-color: #1F3864; color: white; font-weight: bold; text-align: center; }
                                .acta-header-title { font-weight: bold; text-align: center; }
                                .acta-header-info { font-size: .9em; text-align: center; }
                                .acta-nota { font-size: 8pt; text-align: justify; margin: 1rem 0; }
                                .firma-cell { height: 4rem; }
                            </style>
                        </head>
                        <body>
                            ${content.innerHTML}
                        </body>
                    </html>`;
                return html;
            }

            function exportToWord() {
                if (!actaContainer.innerHTML.trim()) {
                    showError("Primero debes generar un acta."); return;
                }
                 if (isEditing) {
                    showError("Guarda los cambios antes de exportar.");
                    return;
                }
                const htmlContent = createWordHtml();
                const blob = new Blob(['\ufeff', htmlContent], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'Acta_de_Reunion.doc';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            function copyToClipboard(text, btnTextEl, successMsg) {
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = btnTextEl.textContent;
                    btnTextEl.textContent = successMsg;
                    setTimeout(() => { btnTextEl.textContent = originalText; }, 2000);
                }).catch(err => console.error('Failed to copy: ', err));
            }

            function showError(message) { errorMessage.textContent = message; errorMessage.classList.remove('hidden'); }
            function hideError() { errorMessage.classList.add('hidden'); }
        });
    </script>
</body>

</html>
